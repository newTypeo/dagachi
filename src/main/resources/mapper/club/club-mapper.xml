<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.dagachi.app.club.repository.ClubRepository">

	<select id="boardList" resultType="clubBoard">
		select
		*
		from
		club_board
		<where>
			<if test="clubId !=null">
				club_id= #{clubId}
			</if>
			<if test="type != 0">
				and type=#{type}
			</if>
		</where>
		order by
		board_id desc
	</select>


	<select id="searchBoard" resultType="clubBoard">
		select
		*
		from
		club_board
		<where>
			<if test="clubId != null">
				and club_id like #{clubId}
			</if>
			<if test="searchType != null">
				and ${searchType} like '%' || #{searchKeyword} || '%'
			</if>
			<if test="type != 0">
				and type= #{type}
			</if>
		</where>
		order by
		board_id desc
	</select>
	
	<select id="searchBoards" resultType="clubBoard">
		select
			*
		from
			club_board
		<where>
			<if test="clubId != null">
					and club_id like #{clubId}
			</if>
			<if test="searchType != null">
					and ${searchType} like '%' || #{searchKeyword} || '%'
			</if>
			<if test="type != 0">
					and type= #{type}
			</if>
			</where>
		order by
			board_id desc

	</select>

	<select id="boardSize" resultType="int">
		select
		count(*)
		from
			(
			select
			*
			from
			club_board
			<where>
				<if test="clubId !=null">
					club_id= #{clubId}
				</if>
				<if test="type != 0">
					and type=#{type}
				</if>
			</where>
			order by
			board_id desc
		)
	</select>



	<select id="clubSearch">
		select
		c.*,
		cp.club_id profile_club_id,
		original_filename,
		renamed_filename,
		cp.created_at profile_created_at
		from
		club c left join club_profile cp
		on c.club_id = cp.club_id
		where
		<if test="inputText != ''">
			club_name like '%' || #{inputText} || '%'
			or
			category like '%' ||
			#{inputText} || '%'
			or
			activity_area like '%' || #{inputText} || '%'
			and
		</if>
		status = 'Y'
		order by
		c.created_at desc
	</select>

	<select id="searchClubWithFilter">
		select
			c.*,
			cp.club_id profile_club_id,
			original_filename,
			renamed_filename,
			cp.created_at profile_created_at,
			(select count(*) from club_member cm where cm.club_id = c.club_id) member_count
		from
			club c left join
			club_profile cp
			on c.club_id = cp.club_id
		where
			(club_name like '%' || #{inputText} || '%'
			or
			category like '%' || #{inputText} || '%'
			or
			activity_area like '%' || #{inputText} || '%')
			<if test="area != null and area != ''">
				and activity_area like '%' || #{area} || '%'
			</if>
			<if test="category != null and category != ''">
				and category = #{category}
			</if>
		order by
			c.created_at desc
	</select>


	<select id="adminClubList">
		select
		*
		from
		club
		<if test="keyword != null and keyword != ''">
			where
			${column} like '%' || #{keyword} || '%'
		</if>
		order by
		created_at desc
	</select>

	<select id="findClubByDistance" parameterType="java.util.Set" >
	    select
			c.*,
			cp.club_id profile_club_id,
			original_filename,
			renamed_filename,
			cp.created_at profile_created_at
		from
			club c left join
			club_profile cp
			on c.club_id = cp.club_id
	    where 
	    <foreach item="zone" collection="zoneSet" separator="or" open="(" close=")">
	       activity_area like '%' || #{zone}
	    </foreach>
	    <if test="category != '' and category != null">
	    	and category = #{category}
	    </if>
	    
	</select>
	
</mapper>
